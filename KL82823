local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

getgenv().AutoKillEnabled = true
getgenv().DebugMode = false
getgenv().SERVER_HOP_INTERVAL = 43
getgenv().MIN_PLAYERS = 10

local LocalPlayer = Players.LocalPlayer
local placeId = game.PlaceId
local hopping = false
local lastAction = tick()
local serverJoinTime = tick()
local teleportAttempts = 0
local MAX_TELEPORT_ATTEMPTS = 5

local excludedNames = {
    ["Nii_OZ"] = true,
    ["VTBR_VoaPassarinho8"] = true,
}

local function log(message)
    if DebugMode then
        print("ðŸ”¹ " .. os.date("[%H:%M:%S] ") .. message)
    end
end

local function hopServer()
    if hopping then return end
    hopping = true
    teleportAttempts = 0
    local function findServer()
        local bestServer
        local cursor
        repeat
            local url = "https://games.roblox.com/v1/games/"..placeId.."/servers/Public?sortOrder=Desc&limit=100"
            if cursor then url = url.."&cursor="..cursor end
            local apiSuccess, response = pcall(function()
                return HttpService:JSONDecode(game:HttpGet(url))
            end)
            if apiSuccess and response and response.data then
                for _, server in ipairs(response.data) do
                    if server.id ~= game.JobId and server.playing < server.maxPlayers then
                        if server.playing >= MIN_PLAYERS then
                            return server.id
                        elseif not bestServer or server.playing > bestServer.playing then
                            bestServer = server
                        end
                    end
                end
                cursor = response.nextPageCursor
            end
        until not cursor
        return bestServer and bestServer.id
    end
    local function attemptTeleport()
        teleportAttempts = teleportAttempts + 1
        if teleportAttempts > MAX_TELEPORT_ATTEMPTS then
            hopping = false
            return
        end
        local serverId = findServer()
        if serverId then
            local success, err = pcall(function()
                TeleportService:TeleportToPlaceInstance(placeId, serverId, LocalPlayer)
            end)
            if success then
                serverJoinTime = tick()
            else
                task.delay(3, attemptTeleport)
            end
        else
            task.delay(10, function()
                hopping = false
                hopServer()
            end)
        end
    end
    attemptTeleport()
end

local function autoAttack()
    if not AutoKillEnabled then return end
    local hand = LocalPlayer.Character and (LocalPlayer.Character:FindFirstChild("RightHand") or LocalPlayer.Character:FindFirstChild("Right Arm"))
    if not hand then return end
    for _, target in ipairs(Players:GetPlayers()) do
        if target ~= LocalPlayer and not excludedNames[target.Name] and target.Character then
            local humanoid = target.Character:FindFirstChildOfClass("Humanoid")
            local root = target.Character:FindFirstChild("HumanoidRootPart")
            if humanoid and humanoid.Health > 0 and root then
                pcall(function()
                    firetouchinterest(hand, root, 0)
                    task.wait(0.05)
                    firetouchinterest(hand, root, 1)
                end)
            end
        end
    end
end

local function autoEquip()
    while task.wait(0.2) and AutoKillEnabled do
        pcall(function()
            local char = LocalPlayer.Character
            if not char then return end
            local egg = LocalPlayer.Backpack:FindFirstChild("Protein Egg")
            if egg then
                egg.Parent = char
            end
            local punch = LocalPlayer.Backpack:FindFirstChild("Punch") or char:FindFirstChild("Punch")
            if punch then
                if punch.Parent ~= char then
                    punch.Parent = char
                end
                punch:Activate()
            end
        end)
    end
end

task.spawn(function()
    while task.wait(1) and AutoKillEnabled do
        local timeInServer = tick() - serverJoinTime
        if timeInServer >= SERVER_HOP_INTERVAL and not hopping then
            hopServer()
        end
    end
end)

task.spawn(function()
    while task.wait(0.1) and AutoKillEnabled do
        pcall(autoAttack)
    end
end)

task.spawn(autoEquip)

RunService.Heartbeat:Connect(function()
    lastAction = tick()
end)

LocalPlayer.OnTeleport:Connect(function(status)
    if status == Enum.TeleportState.Started then
        serverJoinTime = tick()
        hopping = false
    elseif status == Enum.TeleportState.Failed then
        task.delay(5, function()
            hopping = false
            hopServer()
        end)
    end
end)

while task.wait(10) do
    if tick() - lastAction > 60 and not hopping then
        hopServer()
    end
end
